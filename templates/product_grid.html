{# templates/product_grid.html #}
<div id="products-grid-container">
  <div
    id="products-container"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
  >
    {% for product in products %}
    <div class="border rounded-lg p-4 shadow-lg">
      {% if product.images.len() > 0 %}
      <img
        src="{{ product.images[0] }}"
        alt="{{ product.name }}"
        class="w-full h-48 object-cover rounded-md mb-2"
      />
      {% else %}
      <div
        class="w-full h-48 bg-gray-200 rounded-md mb-2 flex items-center justify-center"
      >
        <span class="text-gray-500">Brak zdjęcia</span>
      </div>
      {% endif %}
      <h2 class="text-xl font-semibold mb-1">{{ product.name }}</h2>
      <p class="text-gray-700 mb-1">Cena: {{ product.price / 100 }} zł</p>
      <p class="text-sm text-gray-500 mb-2">Stan: {{ product.condition }}</p>
      <p class="text-sm text-gray-500 mb-2">
        Kategoria: {{ product.category }}
      </p>
      <button
        hx-post="/htmx/cart/add/{{ product.id }}"
        hx-swap="none"
        class="mt-2 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded cursor-pointer transition-transform duration-150 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400"
        title="Dodaj {{ product.name }} do koszyka"
      >
        Dodaj do koszyka
      </button>
      <a
        href="/products/{{ product.id }}"
        hx-get="/htmx/product/{{ product.id }}"
        hx-target="#content"
        hx-swap="innerHTML"
        hx-push-url="/products/{{ product.id }}"
        class="mt-2 ml-2 text-blue-500 hover:text-blue-700"
      >
        Zobacz szczegóły
      </a>
    </div>
    {% else %}
    <p class="col-span-full text-center text-gray-500 py-8">
      Brak produktów spełniających kryteria.
    </p>
    {% endfor %}
  </div>

  {# Paginacja - teraz używa filter_query_string #} {% if total_pages > 0 %} {#
  Pokaż paginację tylko jeśli są jakieś strony #}
  <div
    class="mt-8 flex justify-center items-center space-x-2"
    id="pagination-controls"
  >
    {% if current_page > 1 %}
    <button
      hx-get="/htmx/products?page={{ current_page - 1 }}&amp;limit={{ per_page }}{{ filter_query_string }}"
      hx-target="#products-grid-container"
      hx-swap="outerHTML"
      class="px-4 py-2 border rounded text-blue-600 border-blue-600 hover:bg-blue-100"
    >
      Poprzednia
    </button>
    {% else %}
    <span
      class="px-4 py-2 border rounded text-gray-400 border-gray-300 cursor-not-allowed"
      >Poprzednia</span
    >
    {% endif %}

    <span class="px-4 py-2">Strona {{ current_page }} z {{ total_pages }}</span>

    {% if current_page < total_pages %}
    <button
      hx-get="/htmx/products?page={{ current_page + 1 }}&amp;limit={{ per_page }}{{ filter_query_string }}"
      hx-target="#products-grid-container"
      hx-swap="outerHTML"
      class="px-4 py-2 border rounded text-blue-600 border-blue-600 hover:bg-blue-100"
    >
      Następna
    </button>
    {% else %}
    <span
      class="px-4 py-2 border rounded text-gray-400 border-gray-300 cursor-not-allowed"
      >Następna</span
    >
    {% endif %}
  </div>
  {% endif %}
</div>
