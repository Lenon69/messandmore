<div class="bg-white p-4 sm:p-6 lg:p-8 rounded-lg shadow-xl">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12">
    <div class="space-y-4">
      {% if product.images.len() > 0 %}
      <div
        class="aspect-w-1 aspect-h-1 rounded-lg overflow-hidden border border-gray-200 shadow-sm"
      >
        <img
          id="mainProductImage"
          src="{{ product.images[0] }}"
          alt="Zdjęcie główne: {{ product.name | escape }}"
          class="w-full h-full object-contain object-center cursor-pointer hover:opacity-90 transition-opacity"
          @click="openFullscreenImage($el.src, '{{ product_images_json | safe }}')"
        />
      </div>

      {% if product.images.len() > 1 %}
      <div
        class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-3 lg:grid-cols-4 gap-2 sm:gap-3"
      >
        {% for image_url in product.images %}
        <button
          type="button"
          class="aspect-w-1 aspect-h-1 block border-2 border-transparent hover:border-pink-500 rounded-md overflow-hidden focus:outline-none focus:border-pink-500 transition"
          _="on click set #mainProductImage.src to '{{ image_url }}'"
          aria-label="Zmień główne zdjęcie na miniaturkę {{ loop.index }}"
        >
          <img
            src="{{ image_url }}"
            alt="Miniaturka {{ loop.index }}: {{ product.name | escape }}"
            class="w-full h-full object-cover object-center"
          />
        </button>
        {% endfor %}
      </div>
      {% endif %} {% else %}
      <div
        class="aspect-w-1 aspect-h-1 w-full bg-gray-100 rounded-lg flex items-center justify-center border border-gray-200"
      >
        <p class="text-gray-500">Brak zdjęcia</p>
      </div>
      {% endif %}
    </div>

    <div class="flex flex-col">
      <h1
        class="text-2xl sm:text-3xl lg:text-4xl font-bold tracking-tight text-gray-800 mb-2"
      >
        {{ product.name }}
      </h1>

      <p class="text-3xl font-semibold text-pink-600 mb-5">
        {{ formatted_price }}
      </p>

      <div class="space-y-2 text-sm text-gray-700 mb-5">
        <p>
          <strong class="font-medium text-gray-900">Rodzaj:</strong> {{
          product.gender }}
        </p>
        <p>
          <strong class="font-medium text-gray-900">Kategoria:</strong> {{
          product.category }}
        </p>
        <p>
          <strong class="font-medium text-gray-900">Stan:</strong> {{
          product.condition }}
        </p>
        <p>
          <strong class="font-medium text-gray-900">Status:</strong>
          {% let status_display_string = product.status.to_string() %} {% if
          status_display_string == "Dostępny" %}
          <span
            class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800"
            >Dostępny</span
          >
          {% elif status_display_string == "Zarezerwowany" %}
          <span
            class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800"
            >Zarezerwowany</span
          >
          {% elif status_display_string == "Sprzedany" %}
          <span
            class="px-2 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800"
            >Sprzedany</span
          >
          {% else %}
          <span>{{ status_display_string }}</span>
          {% endif %}
        </p>
      </div>

      <div class="prose prose-sm max-w-none text-gray-600 mb-6">
        <h3 class="text-md font-semibold text-gray-800 mb-1 not-prose">
          Opis produktu:
        </h3>
        {{ product.description | linebreaksbr | safe }}
      </div>

      <div class="mt-auto pt-6">
        {% if product.status.to_string() == "Dostępny" %}
        <button
          hx-post="/htmx/cart/add/{{ product.id }}"
          hx-swap="none"
          class="w-full bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition-all duration-200 ease-in-out hover:shadow-lg hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-opacity-70 cursor-pointer"
          title="Dodaj {{ product.name | escape }} do koszyka"
        >
          Dodaj do koszyka
        </button>
        {% else %}
        <div
          class="w-full text-center py-3 px-6 rounded-lg bg-gray-100 text-gray-500 font-semibold"
        >
          Produkt obecnie niedostępny
        </div>
        {% endif %}

        <div class="mt-4 text-center sm:text-left">
          {% if return_query_params_str.is_some() %} {% let return_qs =
          return_query_params_str.as_ref().unwrap() %}
          <a
            href="/kategoria?{{ return_qs | safe }}"
            hx-get="/htmx/products?{{ return_qs | safe }}"
            hx-target="#content"
            hx-swap="innerHTML"
            hx-push-url="/kategoria?{{ return_qs | safe }}"
            class="text-sm text-blue-600 hover:text-blue-800 hover:underline"
          >
            &larr; Wróć do poprzedniego widoku
          </a>
          {% else %} {% let product_gender_for_link = product.gender.to_string()
          %} {% if product_gender_for_link == "Damskie" %}
          <a
            href="/dla-niej"
            hx-get="/htmx/strona-plec/Damskie"
            hx-target="#content"
            hx-push-url="/dla-niej"
            class="text-sm text-blue-600 hover:text-blue-800 hover:underline"
          >
            &larr; Wróć do {{ product.gender }}
          </a>
          {% elif product_gender_for_link == "Meskie" %}
          <a
            href="/dla-niego"
            hx-get="/htmx/strona-plec/Meskie"
            hx-target="#content"
            hx-push-url="/dla-niego"
            class="text-sm text-blue-600 hover:text-blue-800 hover:underline"
          >
            &larr; Wróć do {{ product.gender }}
          </a>
          {% else %}
          <a
            href="/"
            hx-get="/htmx/products?limit=6"
            hx-target="#content"
            hx-push-url="/"
            class="text-sm text-blue-600 hover:text-blue-800 hover:underline"
          >
            &larr; Wróć na stronę główną
          </a>
          {% endif %} {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
